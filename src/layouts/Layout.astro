---
import '../styles/global.css';
import Header from '../components/Header.astro';

interface Props {
  title?: string;
}

const { title = '자몽의 기술블로그' } = Astro.props;
---

<!doctype html>
<html lang="ko" class="">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <script is:inline>
      // 다크모드 초기화 스크립트 (플래시 방지)
      (function () {
        if (
          localStorage.theme === 'dark' ||
          (!('theme' in localStorage) &&
            window.matchMedia('(prefers-color-scheme: dark)').matches)
        ) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      })();
    </script>
  </head>
  <body class="flex min-h-screen flex-col">
    <Header />
    <main class="mx-auto w-full max-w-5xl flex-1 px-6 py-12 lg:px-8">
      <slot />
    </main>
    <footer
      class="border-t border-token-primary bg-token-secondary py-8 text-center text-sm text-token-tertiary"
    >
      &copy; {new Date().getFullYear()} 자몽의 기술블로그. All rights reserved.
    </footer>
    <script is:inline>
      // 다크모드 토글 함수
      function toggleDarkMode() {
        const html = document.documentElement;
        const isDark = html.classList.contains('dark');

        if (isDark) {
          html.classList.remove('dark');
          localStorage.theme = 'light';
        } else {
          html.classList.add('dark');
          localStorage.theme = 'dark';
        }
      }

      // 전역 함수로 노출
      window.toggleDarkMode = toggleDarkMode;

      // DOMContentLoaded 후 이벤트 리스너 등록
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initDarkModeToggle);
      } else {
        initDarkModeToggle();
      }

      function initDarkModeToggle() {
        const toggleButton = document.getElementById('dark-mode-toggle');
        if (toggleButton) {
          toggleButton.addEventListener('click', toggleDarkMode);
        }
      }
    </script>
  </body>
</html>
